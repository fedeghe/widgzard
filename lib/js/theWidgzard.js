/*




		 ...    .     ...         .       ..                                                          ..       
	  .~`"888x.!**h.-``888h.     @88>   dF                                                          dF         
	 dX   `8888   :X   48888>    %8P   '88bu.                       ..                   .u    .   '88bu.      
	'888x  8888  X88.  '8888>     .    '*88888bu        uL        .@88i         u      .d88B :@8c  '*88888bu   
	'88888 8888X:8888:   )?""`  .@88u    ^"*8888N   .ue888Nc..   ""%888>     us888u.  ="8888f8888r   ^"*8888N  
	 `8888>8888 '88888>.88h.   ''888E`  beWE "888L d88E`"888E`     '88%   .@88 "8888"   4888>'88"   beWE "888L 
	   `8" 888f  `8888>X88888.   888E   888E  888E 888E  888E    ..dILr~` 9888  9888    4888> '     888E  888E 
	  -~` '8%"     88" `88888X   888E   888E  888E 888E  888E   '".-%88b  9888  9888    4888>       888E  888E 
	  .H888n.      XHn.  `*88!   888E   888E  888F 888E  888E    @  '888k 9888  9888   .d888L .+    888E  888F 
	 :88888888x..x88888X.  `!    888&  .888N..888  888& .888E   8F   8888 9888  9888   ^"8888*"    .888N..888  
	 f  ^%888888% `*88888nx"     R888"  `"888*""   *888" 888&  '8    8888 "888*""888"     "Y"       `"888*""   
		  `"**"`    `"**""        ""       ""       `"   "888E '8    888F  ^Y"   ^Y'                   ""      
												   .dWi   `88E  %k  <88F                                       
												   4888~  J8%    "+:*%`                                        
													^"===*"`                              v.0.2


 * Widgzard module
 * 
 * Create an arbitrary dom tree json based allowing for each node to 
 * specify a callback that will be called only when either
 *   > the node is appended (in case the node is a leaf)
 * ||
 *   > every child has finished (explicitly calling the done function on his context)
 *
 * @author Federico Ghedina <federico.ghedina@gmail.com> <2017>
 *
 *

*/
!function(e){"use strict";function n(e,t,o){e=e.replace(/^\//,"");var r,i=e.split(/\.|\//),c=i.length;return void 0===o&&(o=window),void 0===t&&(t={}),"function"==typeof t&&(t=t()),o[i[0]]||(o[i[0]]=1===c?t:{}),r=o[i[0]],c>1?n(i.slice(1).join("."),t,o[i[0]]):r}function t(e,n){e=e.replace(/^\//,"");var t=e.split(/\.|\//),o=0,r=t.length;if(n=void 0!==n?n:window,!e)return n;for(null;o<r;o+=1){if(void 0===n[t[o]])return;n=n[t[o]]}return n}var o=!1;n("FG",{makeNS:n,checkNS:t,debug:function(e){o=!!e},dbg:function(e){if(o)try{console.log(e)}catch(n){try{opera.postError(e)}catch(n){alert(e)}}}}),n("FG.utils",{uniqueId:new function(){var e=0,n=this;this.prefix="FG_",this.toString=function(){return n.prefix+ ++e}}})}(),FG.url=function(){function e(){var e=o.get().replace(/^\#\/?/,"");return t=e.split(/\//)}function n(e){var n=[].slice.call(arguments,0).filter(function(e){return e.length});o.set.apply(null,n)}var t=[],o={get:function(){return document.location.hash},set:function(){t=[].slice.call(arguments,0),document.location.hash="#/"+t.join("/")}};return{hash:t,getHash:e,setHash:n}}(),FG.util={uniqueid:new function(){var e=0,n=this;this.prefix="FG",this.toString=function(){return++e,n.prefix+e}},isValidEmail:function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},delegate:function(e,n){var t=Array.prototype.slice.call(arguments,2);return function(){return e.apply(n||null,[].concat(t,Array.prototype.slice.call(arguments,0)))}},getViewportSize:function(){return void 0!==window.innerWidth?{width:window.innerWidth,height:window.innerHeight}:void 0!==window.document.documentElement&&void 0!==window.document.documentElement.clientWidth&&0!=window.document.documentElement.clientWidth?{width:window.document.documentElement.clientWidth,height:window.document.documentElement.clientHeight}:{width:window.document.getElementsByTagName("body")[0].clientWidth,height:window.document.getElementsByTagName("body")[0].clientHeight}},isMobile:function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|meego.+mobile|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}()},FG.object=function(){function e(e,n){var t,o="";for(t in e)e.hasOwnProperty(t)&&(o+=n(e,t,o));return o}function n(e,n){return t(e)||"undefined"==typeof JSON?e==n:JSON.stringify(e)===JSON.stringify(n)}function t(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function o(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function r(e,r,i,c){if(!e.match(/key|value|keyvalue/))throw new Error("Bad param for object.digFor");c=~~c;var a=0,s={key:function(e,t,o){return FG.object.isString(e)&&o instanceof RegExp?e.match(o):n(e,o)},value:function(e,t,o){return FG.object.isString(t)&&o instanceof RegExp?t.match(o):n(t,o)},keyvalue:function(e,t,o){return(FG.object.isString(e)&&o.key instanceof RegExp?e.match(o.key):n(e,o.key))&&(FG.object.isString(t)&&o.value instanceof RegExp?t.match(o.value):n(t,o.value))}}[e],l=[],u=function(e,n,t,o,r){var i=[].concat.call(e,[n]),c=s(n,o[n],t);c&&(l.push({obj:o,value:o[n],key:i[i.length-1],parentKey:i[i.length-2],path:i.join("/"),container:i.slice(0,i.length-1).join("/"),parentContainer:i.slice(0,i.length-2).join("/"),regexp:c,level:r}),a++),d(o[n],t,i,r+1)},d=function(e,n,r,i){if(!t(e)&&!o(e)){var s,l;if(e instanceof Array)for(s=0,l=e.length;s<l&&(u(r,s,n,e,i),!c||c!=a);s++);else{if("object"!=typeof e)return;for(s in e)if(u(r,s,n,e,i),c&&c==a)break}}};return d(r,i,[],0),l}return{toQs:function(n){return e(n,function(e,n,t){return((t?"&":"?")+encodeURIComponent(n)+"="+encodeURIComponent(e[n])).replace(/\'/g,"%27")})},jCompare:n,digForKey:function(e,n,t){return r("key",e,n,t)},digForValue:function(e,n,t){return r("value",e,n,t)},digForKeyValue:function(e,n,t){return r("value",e,n,t)},isString:function(e){return"string"==typeof e||e instanceof String},extend:function(e,n,t){var o,r=FG.object.clone(e);for(o in n)!n.hasOwnProperty(o)||o in r&&!t||(r[o]=n[o]);return r},clone:function(e){var n,t,o,r=FG.object;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){for(n=[],t=0,o=e.length;t<o;t++)n[t]=r.clone(e[t]);return n}if(e instanceof Object){n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=r.clone(e[t]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}}}(),FG.makeNS("FG/io"),FG.io=function(){var W=window,_={getxhr:function(){var e,n=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"],t=n.length,o=0;try{e=new W.XMLHttpRequest}catch(r){for(null;o<t;o+=1)try{e=new W.ActiveXObject(n[o])}catch(e){continue}!e&&alert("No way to initialize XHR")}return e},ajcall:function(e,n){var t=_.getxhr(),o=n&&n.method||"POST",r=n&&n.cback,i=n&&n.opened||function(){},c=n&&n.loading||function(){},a=n&&n.error||function(){},s=n&&n.abort||function(){},l=n&&n.async||!0,u=n&&n.data||!1,d=n&&n.type||"text/html",f=!n||void 0===n.cache||n.cache,p="xml"===d?"responseXML":"responseText",m=n&&n.timeout||3e3,h=!1,g=!1,v=!1,b=!1;f||(u.C=+new Date),u=FG.object.toQs(u).substr(1),t.onreadystatechange=function(){var e;if(b===t.readyState)return!1;if(b=t.readyState,"complete"===t.readyState||4===t.readyState&&200===t.status)return h=!0,r&&(g=t[p],function(){r(g)}()),v=t[p],W.setTimeout(function(){t=null},50),v;if(3===t.readyState)c(t);else if(2===t.readyState)i(t);else if(1===t.readyState)switch(o){case"POST":try{t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(u||!0)}catch(e){}break;case"GET":try{e={xml:"text/xml",html:"text/html",json:"application/json"}[d]||"text/html",t.setRequestHeader("Accept",e+"; charset=utf-8"),t.send(null)}catch(e){}break;default:alert(o),t.send(null)}return!0},t.onerror=function(){a&&a.apply(null,arguments)},t.onabort=function(){s&&s.apply(null,arguments)},t.open(o,"GET"===o?e+(u?"?"+u:""):e,l),W.setTimeout(function(){h||(h=!0,t.abort())},m);try{return"responseXML"===p?t[p].childNodes[0]:t[p]}catch(e){}return!0}};return{getxhr:_.getxhr,post:function(e,n,t,o,r,i){return _.ajcall(e,{cback:n,method:"POST",async:!!t,data:o,cache:r,error:i})},get:function(e,n,t,o,r,i){return _.ajcall(e,{cback:n||function(){},method:"GET",async:!!t,data:o,cache:r,error:i})},getJson:function(uri,cback,data){return _.ajcall(uri,{type:"json",method:"GET",cback:function(r){cback(W.JSON&&W.JSON.parse?JSON.parse(r):eval("("+r+")"))},data:data})},getXML:function(e,n){return _.ajcall(e,{method:"GET",type:"xml",cback:n||function(){}})}}}(),FG.makeNS("FG/css"),FG.css.style=function(e,n,t){var o,r="object"==typeof n&&void 0===t;if(!r&&void 0===t)return e.currentStyle?e.currentStyle[n]:e.style[n];if(r)for(o in n)e.style[o]=n[o];else void 0!==t&&(t+="",e.style[n]=t,"opacity"===n&&(e.style.filter="alpha(opacity = "+~~(100*parseFloat(t,10))+")"))},FG.dom={addClass:function(e,n){var t=e.className?e.className:"",o=new RegExp("(\\s|^)"+n+"(\\s|$)");t.match(o)||(e.className=n+" "+t)},removeClass:function(e,n){var t=new RegExp("(\\s|^)"+n+"(\\s|$)");e.className=e.className.replace(t," ")},descendant:function(){var e=Array.prototype.slice.call(arguments,0),n=0,t=e.shift(),o=e.length;if(!o)return t;for(;n<o;)t=t.children.item(~~e[n++]);return t},remove:function(e){var n=e.parentNode;n&&n.removeChild(e)}},FG.makeNS("FG/events"),function(){var e={events:{wwdb_bindings:{},getElementDeterminant:function(e){return e.tagName.match(/input|textarea/i)?"value":"innerHTML"}}};FG.events.on=function(e){return"addEventListener"in e?function(e,n,t){e.addEventListener.apply(e,[n,t,!1])}:"attachEvent"in e?function(e,n,t){e.attachEvent.apply(e,["on"+n,t])}:function(){throw new Error("No straight way to bind an event")}}(this),FG.events.eventTarget=function(e){e=e||window.event;var n=e.currentTarget||void 0!==e.target?e.target:e.srcElement;if(!n)return!1;for(;3===n.nodeType&&null!==n.parentNode;)n=n.parentNode;return n},FG.events.kill=function(e){return e||(e=W.event,e.cancelBubble=!0,e.returnValue=!1),"stopPropagation"in e&&e.stopPropagation()&&e.preventDefault(),!1},FG.events.onNoEvent=function(e,n,t){function o(e){r&&window.clearTimeout(r),r=window.setTimeout(function(){n(e)},t)}t=t||3e3;var r,i=FG.events;i.on(e,"mousemove",o),i.on(e,"click",o),i.on(e,"touchstart",o)},FG.events.ready=function(){var e=[],n=setInterval(function(){if("complete"===document.readyState){clearInterval(n);for(var t=0,o=e.length;t<o;t++)e[t].call(this)}},10);return function(n){"complete"===document.readyState?n.call(this):e.push(n)}}(),FG.events.transitionEnd=function(){var e,n=document.createElement("fake"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(void 0!==n.style[e])return t[e]}(),FG.events.ww={on:function(n,t,o,r){var i=!1,c=!1,a=e.events.getElementDeterminant(o),s=o[a],l=n[t],u=function(e){i=c=!!e};o.wwdbID="_"+FG.util.uniqueid,e.events.wwdb_bindings[o.wwdbID]=window.setInterval(function(){i||(u(!0),l!=n[t]&&(s=n[t],l=s,o[a]=s),u(!1))},25),FG.events.on(o,"keyup",function(){c||(u(!0),this[a]!=n[t]&&(n[t]=this[a],s=this[a],l=this[a]),u(!1))}),o[a]=l},off:function(){for(var n=[].slice.call(arguments,0),t=n.length;t-- >0;)FG.events.off(n[t],"keyup"),window.clearInterval(e.events.wwdb_bindings[n[t].wwdbID])}}}(),FG.string={code2str:function(e){return String.fromCharCode.apply(null,e)},multireplace:function(e,n){for(var t in n)e=e.replace(n[t],t);return e},regEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},repeat:function(e,n){return new Array(n+1).join(e)},replaceAll:function(e,n,t){var o,r,i,c="%",a="%",s=null,l=!1,u=!0;void 0!=t&&("delim"in t&&(c=t.delim[0],a=t.delim[1]),"fb"in t&&(s=t.fb),l=!!t.clean),o=new RegExp(c+"(\\+)?([A-z0-9-_.]*)"+a,"g");for(;u;){if(!e.match(o))return e;e=e.replace(o,function(e,t,o,d){if("function"==typeof n)r=n(o),d=r!==c+o+a?n(o):o;else if(o in n)d=typeof n[o],d="function"===d?n[o](o):"object"===d?"":n[o];else{if(o.match(/\./)&&(i=FG.checkNS(o,n)))return d=t?encodeURIComponent(i):i,"function"==typeof i?i(o):i;u=!1,d=null!==s?s:l?"":c+o+a}return t?encodeURIComponent(d):d})}return e},str2code:function(e){for(var n=[],t=0,o=e.length;t<o;)n.push(e.charCodeAt(t)),t+=1;return n},str2hex:function(e){for(var n=[],t=0,o=e.length;t<o;)n.push("\\X"+parseInt(e.charCodeAt(t),10).toString(16).toUpperCase()),t+=1;return""+n.join("").replace(/X/g,"x")},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},triml:function(e){return e.replace(/^\s+/g,"")},trimr:function(e){return e.replace(/\s+$/g,"")},ucFirst:function(e){return e.replace(/^\w/,function(e){return e.toUpperCase()})}},FG.Channel=function(){var e={},n=function(e,n){if("indexOf"in e)return e.indexOf(n);for(var t=e.length-1;e[t]!==n;)t--;return t},t=function(){this.topic2cbs={},this.enabled=!0};return t.prototype={enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},pub:function(e,n){var t,o=0;if(!(e in this.topic2cbs&&this.enabled))return!1;for(t=this.topic2cbs[e].length;o<t;o+=1)this.topic2cbs[e][o].apply(null,[e].concat(n));return!0},sub:function(e,t,o){var r,i=0;if(e instanceof Array)for(r=e.length;i<r;i+=1)this.sub(e[i],t);if(e in this.topic2cbs&&this.enabled||(this.topic2cbs[e]=[]),!o&&n(this.topic2cbs[e],t)>=0)return this;this.topic2cbs[e].push(t)},unsub:function(e,t){var o,r=0;if(e instanceof Array)for(o=e.length;r<o;r+=1)this.unsub(e[r],t);return e in this.topic2cbs&&(r=n(this.topic2cbs[e],t))>=0&&this.topic2cbs[e].splice(r,1),this},once:function(e,n){var t=this,o=function(){n.apply(null,Array.prototype.slice.call(arguments,0)),t.unsub(e,o)};this.sub(e,o)},reset:function(){var e=Array.prototype.slice.call(arguments,0),n=e.length,t=0;if(!n)return this.topic2cbs={},this;for(null;t<n;t+=1)e[t]in this.topic2cbs&&(this.topic2cbs[e[t]]=[]);return this}},function(n){return n in e?e[n]:e[n]=new t}}(),FG.makeNS("FG/i18n",function(){var e={};return FG.lang="undefined"!=typeof sm_lang?sm_lang:"en",{load:function(n){e=n},parse:function(e){var n,t,o,r,i=FG.object.digForValue(e,/i18n\(([^}|]*)?\|?([^}]*)\)/);for(o=0,r=i.length;o<r;o++)(typeof i[o].regexp).match(/boolean/i)||(n=FG.i18n.check(i[o].regexp[0]))&&(t=FG.checkNS(i[o].container,e),t[i[o].key]=FG.i18n.get(n[1],n[2]))},dynamicLoad:function(n,t){for(t in n)FG.lang in n[t]&&(e[t]=n[t][FG.lang])},check:function(e){return e.match(/i18n\(([^}|]*)?\|?([^}]*)\)/)},get:function(n,t){return FG.checkNS(n,e)||t||"no Value"}}}),FG.Promise=function(){function e(e,n){for(var o=new t,r=function(){return e[0].apply(o,[o].concat([n])),o}(),i=[r],c=1,a=e.length;c<a;c++)i.push(i[c-1].then(e[c]));return o}function n(e,n){var o=new t,r=[],i=[],c=0,a=e.length,s=a,l=function(e){!e&&o.done.apply(o,r)};for(null;c<a;c++)!function(o){i[o]=new t;var c=e[o].apply(i[o],[i[o],n]);(c instanceof t?c:i[o]).then(function(e,n){r[o]=n,l(--s)})}(c);return o}var t=function(){this.cbacks=[],this.solved=!1,this.result=null},o=t.prototype;return o.then=function(e,n){var t=this,o=function(){t.solved=!1,e.apply(n||t,[n||t,t.result])};return this.solved?o():this.cbacks.push(o),this},o.done=function(){var e=[].slice.call(arguments,0);if(this.result=e,this.solved=!0,!this.cbacks.length)return this.result;this.cbacks.shift()(e)},{create:function(){return new t},chain:e,join:n}}(),function(W){function Wnode(e,n,t){"use strict";var o=this,r=e.tag||"div";this.target=n,this.node=e.ns?document.createElementNS(e.ns,r):document.createElement(r),this.conf=e,this.root=t.root,this.parent=n,this.map=t.map,this.abort=t.abort,this.getNode=t.getNode,this.getNodes=t.getNodes,this.WIDGZARD_promise=__promise.create(),this.WIDGZARD_cb=e.cb||function(){__debug&&console.log("autoresolving  ",o.node),o.resolve()},this.WIDGZARD_promise.then(o.WIDGZARD_cb,o),this.WIDGZARD_len=e.content?e.content.length:0,this.done=this.resolve=this.solve=function(){0==--o.target.WIDGZARD_len&&(o.target.WIDGZARD_promise?o.target.WIDGZARD_promise.done():o.target.WIDGZARD_cb())},this.lateWid=t.lateWid}function cleanupWnode(e){var n=e.node,t=[],o=["WIDGZARD","WIDGZARD_cb","WIDGZARD_promise","WIDGZARD_length","parent","getNode","climb","root","done","resolve","data"],r=o.length,i=0,c=0,a=0,s=null;for(eulerWalk(n,function(e){e!==n&&3!=e.nodeType&&t.push(e)&&a++},"post");c<a;){for(s=t[c++];i<r;)s[o[i++]]=null;!function(e){e.parentNode.removeChild(e)}(s)}return t=null,o=null,!0}function render(e,n,t){var o,r,i=+new Date,c={node:e.target||document.body,endFunctions:[],childrens:[],reload:function(){render(e,!0)}},a={node:document.createDocumentFragment("div")},s=!0,l=c.node.innerHTML+"";if(__debug=!!e.debug,__autoclean&&c.WIDGZARD&&cleanupWnode(c),!e)throw new Exception("ERROR : Check parameters for render function");return r={root:c,map:{},getNode:function(e){return r.map[e]||!1},getNodes:function(){return r.map},abort:function(){return s=!1,c.node.innerHTML=l,"onAbort"in e&&(typeof e.onAbort).match(/function/i)&&e.onAbort.call(null,e),!1},lateWid:function(e){r.map[e]=this}},Wnode.prototype.setAttrs(c.node,e.attrs).setStyle(c.node,e.style).setData(c,e.data).setData(a,e.data),a.descendant=Wnode.prototype.descendant,n&&(c.node.innerHTML=""),void 0!==e.html&&(c.node.innerHTML=e.html),a.WIDGZARD_len=e.content?e.content.length:0,a.WIDGZARD_cb=c.WIDGZARD_cb=function(){if(s&&c.node.appendChild(a.node)&&e.cb&&e.cb.call(c),c.endFunctions.length)for(var n=0,t=c.endFunctions.length;n<t;n++)c.endFunctions[n]()},c.WIDGZARD=!0,c.getNode=r.getNode,c.getNodes=r.getNodes,c.abort=r.abort,c.map=r.map,c.report=function(){window.JSON&&console.log("json size : "+JSON.stringify(e).length),console.log("html size : "+c.node.innerHTML.length)},Wnode.prototype.checkInit(a,e),function e(n,t){if(!s)return!1;if(n.content)for(var o=0,i=n.content.length;o<i;o++)n.content[o]===__clearerClassName&&(n.content[o]={tag:"br",attrs:{class:__clearerClassName}}),"ns"in n&&(n.content[o].ns=n.ns),e(n.content[o],new Wnode(n.content[o],t,r).add())}(e,a),"content"in e||a.WIDGZARD_cb(),!t||t in __renders||(__renders[t]=c),o=+new Date,console.debug("Widgzard render time: "+(o-i)+"ms"),c}function get(e){var n=document.createElement("div");return e.target=n,render(e),n}function cleanup(e,n){render({target:e,content:[{html:n||""}]},!0)}function load(e){var n=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(n),n.src=e,n.onload=function(){n.parentNode.removeChild(n)}}function eulerWalk(e,n,t){t={pre:"pre",post:"post"}[t]||"post";var o=function(){},r="pre"===t?n:o,i="post"===t?n:o;!function e(n,t){for(r(n),t=n.firstChild;t;)e(t),t=t.nextSibling;i(n)}(e)}function htmlspecialchars(e){return"<pre>"+e.replace(/&(?![\w\#]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")+"</pre>"}console.log("\n\n WIDGZARD v.0.2\n\n");var __clearerClassName="clearer",__nodeIdentifier="wid",__autoclean=!0,__debug=!1,__promise=FG.Promise,__renders={};Wnode.prototype.climb=function(e){e=e||1;for(var n=this;e--;)n=n.parent;return n},Wnode.prototype.descendant=function(){var e=this,n=Array.prototype.slice.call(arguments,0),t=0,o=e,r=n.length;if(!r)return o;for(;t<r;)o=o.childrens[~~n[t++]];return o},Wnode.prototype.setAttrs=function(e,n){if(void 0!==n)for(var t in n)"class"!==t?"style"!==t?e.setAttribute(t,n[t]):this.setStyle(e,n.style):e.className=n[t];return this},Wnode.prototype.setStyle=function(e,n){if(void 0!==n)for(var t in n)e.style[t.replace(/^float$/i,"cssFloat")]=n[t];return this},Wnode.prototype.setData=function(e,n){return e.data=n||{},this},Wnode.prototype.checkInit=function(e,n){return"init"in n&&"function"==typeof n.init&&!n.init.call(e)&&e.abort(),this},Wnode.prototype.checkEnd=function(e,n){return"end"in n&&"function"==typeof n.end&&this.root.endFunctions.push(function(){n.end.call(e)}),this},Wnode.prototype.add=function(){var conf=this.conf,node=this.node,tmp,i,j,k;return this.setAttrs(node,conf.attrs).setStyle(node,conf.style).setData(this,conf.data).checkInit(this,conf).checkEnd(this,conf),void 0!==conf.html&&(node.innerHTML=conf.html,(tmp=node.innerHTML.match(/2wdb\((.*)\)/))&&void 0!==(i=FG.checkNS(tmp[1],this))&&(j=("this."+tmp[1]).split("."),k=j.pop(),i=eval(j.join(".")),k in i&&FG.events.ww.on(i,k,node))),void 0!==conf.text&&(tmp=document.createTextNode(""+conf.text),node.appendChild(tmp)),void 0!==conf[__nodeIdentifier]&&(this.map[conf[__nodeIdentifier]]=this),(conf.target||this.target.node).appendChild(node),"childrens"in(conf.target||this.target)||((conf.target||this.target).childrens=[]),(conf.target||this.target).childrens.push(this),this.WIDGZARD=!0,(!conf.content||0==conf.content.length)&&this.WIDGZARD_cb.call(this),this},FG.Widgzard={render:render,cleanup:cleanup,get:get,load:load,htmlspecialchars:htmlspecialchars,getElement:function(e){return e in __renders&&__renders[e]},getElements:function(){return __renders},Promise:__promise}}(this),FG.makeNS("engy",function(){function _configSet(e){var n;for(n in config)n in e&&(config[n]=e[n]);return this}function _overwrite(e,n,t){for(var o=n.split(/\.|\//),r=o.length,i=0;i<r-1;)e=e[o[i++]];e[o[r-1]]=t}function _mergeComponent(e,n,t){var o,r=FG.checkNS(n,e),i=t,c={},a=n.split(/\.|\//),o=0;a.length;for(o in i)c[o]=i[o];for(o in r)!o.match(/component|params/)&&(c[o]=r[o]);_overwrite(e,n,c)}function Processor(e){this.config=e,this.endPromise=FG.Promise.create()}function _process(e){return new Processor(e).run()}function _component(e,n){e in preloadedComponents||(preloadedComponents[Processor.prototype.getFileName(e)]=n)}function _components(e){for(var n in e)_component(n,e[n])}function _clone(e){if(null==e||"object"!=typeof e)return e;var n=e.constructor();for(var t in e)e.hasOwnProperty(t)&&(n[t]=_clone(e[t]));return n}console.log("\n\n ENGY v.0.3\n\n");var components={},preloadedComponents={},config={fileNameSeparator:"/",fileNamePrepend:"",ext:".js",componentsUrl:"/components/"},num=0;return Processor.prototype.getFileName=function(e){var n=e.split(/\/|\|/),t=e,o=n.length;return n[o-1]=config.fileNamePrepend+n[o-1],t=n.join(config.fileNameSeparator),config.componentsUrl+t+config.ext},Processor.prototype.run=function(){var self=this,langFunc=FG.i18n.parse,elementsN=0,countPromise=FG.Promise.create(),solveTime=FG.Promise.create(),start=+new Date,end,xhrTot=0,cback;return function solve(){var component=FG.object.digForKey(self.config,"component",1),componentName,cached,preLoaded,innerPromise=FG.Promise.create(),xhrStart=0,xhrEnd=0;innerPromise.then(solve),component.length?(elementsN++,component=component[0],componentName=self.getFileName(component.value),cached=componentName in components,preLoaded=componentName in preloadedComponents,cback=function(cntORobj){xhrEnd=+new Date,xhrTot+=xhrEnd-xhrStart;var params=FG.checkNS(component.container+"/params",self.config),obj,usedParams,foundParam,foundParamValue,foundParamValueReplaced,i,l;if(preLoaded?obj=_clone(cntORobj):(cached||(components[componentName]=_clone(cntORobj)),cntORobj=cntORobj.replace(/^[^{]*/,"").replace(/;?$/,""),obj=eval("("+cntORobj+")")),params&&(usedParams=FG.object.digForValue(obj,/#PARAM{([^}|]*)?\|?([^}]*)}/),l=usedParams.length))for(i=0;i<l;i++)foundParam=FG.checkNS(usedParams[i].regexp[1],params),foundParamValue=void 0!==foundParam?foundParam:usedParams[i].regexp[2]||"",(typeof foundParamValue).match(/string/i)?(foundParamValueReplaced=FG.checkNS(usedParams[i].path,obj).replace(usedParams[i].regexp[0],foundParamValue),_overwrite(obj,usedParams[i].path,foundParamValueReplaced)):_overwrite(obj,usedParams[i].path,foundParamValue);component.container?_mergeComponent(self.config,component.container,obj):self.config=obj,innerPromise.done()},xhrStart=+new Date,preLoaded?cback(preloadedComponents[componentName]):cached?cback(components[componentName]):FG.io.get(componentName,cback,!0)):(end=+new Date,self.endPromise.done(self.config),countPromise.done(elementsN),solveTime.done(end-start))}(),langFunc&&langFunc(self.config),countPromise.then(function(e,n){console.log("Engy components used: "+n[0])}),solveTime.then(function(e,n){console.log("Engy time for getting components via xhr: "+xhrTot),console.log('      "       unfolding : '+(n[0]-xhrTot)),console.log('      "       solving (xhr included): '+n[0])}),self.endPromise},{configSet:_configSet,process:_process,component:_component,components:_components,get:function(e,n,t){var o=FG.Promise.create();return _process(e).then(function(e,n){o.done(FG.Widgzard.get(n[0]))}),o},load:function(e){return FG.Widgzard.load(e)},getElement:function(e){return FG.Widgzard.getElement(e)},getElements:function(){return FG.Widgzard.getElements()},render:function(e,n,t){var o=+new Date,r=FG.Promise.create();return _process(e).then(function(e,i){console.log("t: "+(+new Date-o)),r.done(FG.Widgzard.render(i[0],n,t))}),r}}},FG);