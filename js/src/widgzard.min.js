!function(){"use strict";function t(t,e,n){var o=this,r=t.tag||"div";this.target=e,this.node=document.createElement(r),this.conf=t,this.WIDGZARD_cb=t.cb||function(){h&&console.log("autoresolving  ",o.node),o.resolve()},this.root=n.root,this.parent=e,this.WIDGZARD_promise=p.create(),this.WIDGZARD_promise.then(o.WIDGZARD_cb,o),this.map=n.map,this.abort=n.abort,this.getNode=n.getNode,this.getNodes=n.getNodes,this.WIDGZARD_len=t.content?t.content.length:0,this.done=this.resolve=this.solve=function(){0==--o.target.WIDGZARD_len&&(o.target.WIDGZARD_promise?o.target.WIDGZARD_promise.done():o.target.WIDGZARD_cb())},this.lateWid=n.lateWid}function e(t){var e=t.node,n=function(t){return t.parentNode.removeChild(t),!0},o=[],r=["WIDGZARD","WIDGZARD_cb","WIDGZARD_promise","WIDGZARD_length","parent","getNode","climb","root","done","resolve","data"],i=r.length,c=0,a=0,d=0,l=null;for(s(e,function(t){t!==e&&3!=t.nodeType&&o.push(t)&&d++},"post");d>a;){for(l=o[a++];i>c;)l[r[c++]]=null;n(l)}return o=null,r=null,!0}function n(o,r,i){var c,a=+new Date,s={node:o.target||document.body,endFunctions:[],reload:function(){n(o,!0)}},l={node:document.createDocumentFragment("div")},p=!0,D=s.node.innerHTML+"";if(h=!!o.debug,u&&s.WIDGZARD&&e(s),!o)throw new Exception("ERROR : Check parameters for render function");var m={root:s,map:{},getNode:function(t){return m.map[t]||!1},getNodes:function(){return m.map},abort:function(){return p=!1,s.node.innerHTML=D,"onAbort"in o&&(typeof o.onAbort).match(/function/i)&&o.onAbort.call(null,o),!1},lateWid:function(t){m.map[t]=this}};return f.setAttrs(s.node,o.attrs).setStyle(s.node,o.style).setData(s,o.data).setData(l,o.data),s.descendant=f.descendant,l.descendant=f.descendant,r&&(s.node.innerHTML=""),"undefined"!=typeof o.html&&(s.node.innerHTML=o.html),s.WIDGZARD_len=o.content?o.content.length:0,l.WIDGZARD_len=o.content?o.content.length:0,l.WIDGZARD_cb=s.WIDGZARD_cb=function(){if(p&&s.node.appendChild(l.node)&&o.cb&&o.cb.call(s),s.endFunctions.length)for(var t=0,e=s.endFunctions.length;e>t;t++)s.endFunctions[t]()},s.WIDGZARD=!0,s.getNode=l.getNode=m.getNode,s.getNodes=l.getNodes=m.getNodes,s.abort=l.abort=m.abort,f.checkInit(l,o),function A(e,n){if(!p)return!1;if(e.content)for(var o=0,r=e.content.length;r>o;o++)e.content[o]===d&&(e.content[o]={tag:"br",attrs:{"class":d}}),A(e.content[o],new t(e.content[o],n,m).add())}(o,l),"content"in o||l.WIDGZARD_cb(),!i||i in g||(g[i]=s),c=+new Date,console.debug("Widgzard render time: "+(c-a)+"ms"),s}function o(t){var e=document.createElement("div");return t.target=e,n(t),e}function r(t,e){n({target:t,content:[{html:e||""}]},!0)}function i(t){var e=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(e),e.src=t,e.onload=function(){e.parentNode.removeChild(e)}}var c,a,s,d="clearer",l="wid",u=!0,h=!1,f=t.prototype,p=$ns$.Promise,g={};f.climb=function(t){t=t||1;for(var e=this;t--;)e=e.parent;return e},f.descendant=function(){var t=this,e=Array.prototype.slice.call(arguments,0),n=0,o=t,r=e.length;if(!r)return o;for(;r>n;)o=o.childrens[~~e[n++]];return o},f.setAttrs=function(t,e){if("undefined"!=typeof e)for(var n in e)"class"!==n?"style"!==n?t.setAttribute(n,e[n]):this.setStyle(t,e.style):t.className=e[n];return this},f.setStyle=function(t,e){if("undefined"!=typeof e)for(var n in e)t.style[n.replace(/^float$/i,"cssFloat")]=e[n];return this},f.setData=function(t,e){return t.data=e||{},this},f.checkInit=function(t,e){var n=!0;return"init"in e&&"function"==typeof e.init&&(n=e.init.call(t),!n&&t.abort()),this},f.checkEnd=function(t,e){return"end"in e&&"function"==typeof e.end&&this.root.endFunctions.push(function(){e.end.call(t)}),this},f.add=function(){var t,e=this.conf,n=this.node;return this.setAttrs(n,e.attrs).setStyle(n,e.style).setData(this,e.data).checkInit(this,e).checkEnd(this,e),"undefined"!=typeof e.html&&(n.innerHTML=e.html),"undefined"!=typeof e.text&&(t=document.createTextNode(""+e.text),n.appendChild(t)),"undefined"!=typeof e[l]&&(this.map[e[l]]=this),(e.target||this.target.node).appendChild(n),"childrens"in(e.target||this.target)||((e.target||this.target).childrens=[]),(e.target||this.target).childrens.push(this),this.WIDGZARD=!0,(!e.content||0==e.content.length)&&this.WIDGZARD_cb.call(this),this},s=function(t,e,n){n={pre:"pre",post:"post"}[n]||"post";var o=function(){},r="pre"===n?e:o,i="post"===n?e:o,c=function(){return function(t,e){for(r(t),e=t.firstChild;e;)c(e),e=e.nextSibling;i(t)}}();c(t)},a=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e||window,[].concat(n,Array.prototype.slice.call(arguments)))}},c=function(t){return"<pre>"+t.replace(/&(?![\w\#]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")+"</pre>"},$ns$.Widgzard={render:n,cleanup:r,get:o,load:i,htmlspecialchars:c,getElement:function(t){return t in g?g[t]:!1},getElements:function(){return g}}}(this);