FG.Promise=function(){function e(e,n){for(var o=new t,r=function(){return e[0].apply(o,[o].concat([n])),o}(),i=[r],a=1,c=e.length;c>a;a++)i.push(i[a-1].then(e[a]));return o}function n(e,n){var o=new t,r=[],i=[],a=0,c=e.length,s=c,l=function(e){!e&&o.done.apply(o,r)};for(null;c>a;a++)!function(o){i[o]=new t;var a=e[o].apply(i[o],[i[o],n]);(a instanceof t?a:i[o]).then(function(e,n){r[o]=n,l(--s)})}(a);return o}var t=function(){this.cbacks=[],this.solved=!1,this.result=null},o=t.prototype;return o.then=function(e,n){var t=this,o=function(){t.solved=!1,e.apply(n||t,[n||t,t.result])};return this.solved?o():this.cbacks.push(o),this},o.done=function(){var e=[].slice.call(arguments,0);return this.result=e,this.solved=!0,this.cbacks.length?void this.cbacks.shift()(e):this.result},{create:function(){return new t},chain:e,join:n}}(),function(e){function n(e,n,t){var o=this,r=e.tag||"div";this.target=n,this.node=e.ns?document.createElementNS(e.ns,r):document.createElement(r),this.conf=e,this.WIDGZARD_cb=e.cb||function(){h&&console.log("autoresolving  ",o.node),o.resolve()},this.root=t.root,this.parent=n,this.WIDGZARD_promise=p.create(),this.WIDGZARD_promise.then(o.WIDGZARD_cb,o),this.map=t.map,this.abort=t.abort,this.getNode=t.getNode,this.getNodes=t.getNodes,this.WIDGZARD_len=e.content?e.content.length:0,this.done=this.resolve=this.solve=function(){0==--o.target.WIDGZARD_len&&(o.target.WIDGZARD_promise?o.target.WIDGZARD_promise.done():o.target.WIDGZARD_cb())},this.lateWid=t.lateWid}function t(e){var n=e.node,t=function(e){return e.parentNode.removeChild(e),!0},o=[],r=["WIDGZARD","WIDGZARD_cb","WIDGZARD_promise","WIDGZARD_length","parent","getNode","climb","root","done","resolve","data"],i=r.length,a=0,s=0,l=0,u=null;for(c(n,function(e){e!==n&&3!=e.nodeType&&o.push(e)&&l++},"post");l>s;){for(u=o[s++];i>a;)u[r[a++]]=null;t(u)}return o=null,r=null,!0}function o(e,r,i){var a,c,s=+new Date,u={node:e.target||document.body,endFunctions:[],reload:function(){o(e,!0)}},p={node:document.createDocumentFragment("div")},g=!0,v=u.node.innerHTML+"";if(h=!!e.debug,d&&u.WIDGZARD&&t(u),!e)throw new Exception("ERROR : Check parameters for render function");return c={root:u,map:{},getNode:function(e){return c.map[e]||!1},getNodes:function(){return c.map},abort:function(){return g=!1,u.node.innerHTML=v,"onAbort"in e&&(typeof e.onAbort).match(/function/i)&&e.onAbort.call(null,e),!1},lateWid:function(e){c.map[e]=this}},f.setAttrs(u.node,e.attrs).setStyle(u.node,e.style).setData(u,e.data).setData(p,e.data),u.descendant=f.descendant,p.descendant=f.descendant,r&&(u.node.innerHTML=""),"undefined"!=typeof e.html&&(u.node.innerHTML=e.html),u.WIDGZARD_len=e.content?e.content.length:0,p.WIDGZARD_len=e.content?e.content.length:0,p.WIDGZARD_cb=u.WIDGZARD_cb=function(){if(g&&u.node.appendChild(p.node)&&e.cb&&e.cb.call(u),u.endFunctions.length)for(var n=0,t=u.endFunctions.length;t>n;n++)u.endFunctions[n]()},u.WIDGZARD=!0,u.getNode=p.getNode=c.getNode,u.getNodes=p.getNodes=c.getNodes,u.abort=p.abort=c.abort,u.map=p.map=c.map,f.checkInit(p,e),function D(e,t){if(!g)return!1;if(e.content)for(var o=0,r=e.content.length;r>o;o++)e.content[o]===l&&(e.content[o]={tag:"br",attrs:{"class":l}}),D(e.content[o],new n(e.content[o],t,c).add())}(e,p),"content"in e||p.WIDGZARD_cb(),!i||i in m||(m[i]=u),a=+new Date,console.debug("Widgzard render time: "+(a-s)+"ms"),u}function r(e){var n=document.createElement("div");return e.target=n,o(e),n}function i(e,n){o({target:e,content:[{html:n||""}]},!0)}function a(e){var n=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(n),n.src=e,n.onload=function(){n.parentNode.removeChild(n)}}function c(e,n,t){t={pre:"pre",post:"post"}[t]||"post";var o=function(){},r="pre"===t?n:o,i="post"===t?n:o;!function a(e,n){for(r(e),n=e.firstChild;n;)a(n),n=n.nextSibling;i(e)}(e)}function s(e){return"<pre>"+e.replace(/&(?![\w\#]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")+"</pre>"}console.log("\n\n WIDGZARD \n\n");var l="clearer",u="wid",d=!0,h=!1,f=n.prototype,p=FG.Promise,m={};p=function(){function e(e,n){for(var o=new t,r=function(){return e[0].apply(o,[o].concat([n])),o}(),i=[r],a=1,c=e.length;c>a;a++)i.push(i[a-1].then(e[a]));return o}function n(e,n){var o=new t,r=[],i=[],a=0,c=e.length,s=c,l=function(e){!e&&o.done.apply(o,r)};for(null;c>a;a++)!function(o){i[o]=new t;var a=e[o].apply(i[o],[i[o],n]);(a instanceof t?a:i[o]).then(function(e,n){r[o]=n,l(--s)})}(a);return o}var t=function(){this.cbacks=[],this.solved=!1,this.result=null},o=t.prototype;return o.then=function(e,n){var t=this,o=function(){t.solved=!1,e.apply(n||t,[n||t,t.result])};return this.solved?o():this.cbacks.push(o),this},o.done=function(){var e=[].slice.call(arguments,0);return this.result=e,this.solved=!0,this.cbacks.length?void this.cbacks.shift()(e):this.result},{create:function(){return new t},chain:e,join:n}}(),f.climb=function(e){e=e||1;for(var n=this;e--;)n=n.parent;return n},f.descendant=function(){var e=this,n=Array.prototype.slice.call(arguments,0),t=0,o=e,r=n.length;if(!r)return o;for(;r>t;)o=o.childrens[~~n[t++]];return o},f.setAttrs=function(e,n){if("undefined"!=typeof n)for(var t in n)"class"!==t?"style"!==t?e.setAttribute(t,n[t]):this.setStyle(e,n.style):e.className=n[t];return this},f.setStyle=function(e,n){if("undefined"!=typeof n)for(var t in n)e.style[t.replace(/^float$/i,"cssFloat")]=n[t];return this},f.setData=function(e,n){return e.data=n||{},this},f.checkInit=function(e,n){var t=!0;return"init"in n&&"function"==typeof n.init&&(t=n.init.call(e),!t&&e.abort()),this},f.checkEnd=function(e,n){return"end"in n&&"function"==typeof n.end&&this.root.endFunctions.push(function(){n.end.call(e)}),this},f.add=function(){var e,n=this.conf,t=this.node;return this.setAttrs(t,n.attrs).setStyle(t,n.style).setData(this,n.data).checkInit(this,n).checkEnd(this,n),"undefined"!=typeof n.html&&(t.innerHTML=n.html),"undefined"!=typeof n.text&&(e=document.createTextNode(""+n.text),t.appendChild(e)),"undefined"!=typeof n[u]&&(this.map[n[u]]=this),(n.target||this.target.node).appendChild(t),"childrens"in(n.target||this.target)||((n.target||this.target).childrens=[]),(n.target||this.target).childrens.push(this),this.WIDGZARD=!0,(!n.content||0==n.content.length)&&this.WIDGZARD_cb.call(this),this},FG.Widgzard={render:o,cleanup:i,get:r,load:a,htmlspecialchars:s,getElement:function(e){return e in m?m[e]:!1},getElements:function(){return m},Promise:p}}(this),FG.makeNS("engy3",function(){function _overwrite(e,n,t){for(var o=n.split(/\.|\//),r=o.length,i=0;r-1>i;)e=e[o[i++]];e[o[r-1]]=t}function _mergeComponent(e,n,t){var o,r=FG.checkNS(n,e),i=t,a={},c=n.split(/\.|\//),o=0;c.length;for(o in i)a[o]=i[o];for(o in r)!o.match(/component|params/)&&(a[o]=r[o]);_overwrite(e,n,a)}function Processor(e){this.config=e,this.endPromise=FG.Promise.create()}function process(e){return new Processor(e).run()}console.log("\n\n ENGY \n\n");var components={},config={fileNameSeparator:"/",fileNamePrepend:"",ext:".js",componentsUrl:"/engy/components/"},num=0;return Processor.prototype.getFileName=function(e){var n=e.split(/\/|\|/),t=e,o=n.length;return n[o-1]=config.fileNamePrepend+n[o-1],t=n.join(config.fileNameSeparator),config.componentsUrl+t+config.ext},Processor.prototype.run=function(){var self=this,langFunc=FG.i18n.parse,elementsN=0,countPromise=FG.Promise.create(),solveTime=FG.Promise.create(),start=+new Date,end,xhrTot=0,cback;return function solve(){var component=FG.object.digForKey(self.config,"component",1),componentName,cached,innerPromise=FG.Promise.create(),xhrStart=0,xhrEnd=0;innerPromise.then(solve),component.length?(elementsN++,component=component[0],componentName=self.getFileName(component.value),cached=componentName in components,cback=function(xhrResponseText){xhrEnd=+new Date,xhrTot+=xhrEnd-xhrStart;var params=FG.checkNS(component.container+"/params",self.config),obj,usedParams,foundParam,foundParamValue,foundParamValueReplaced,i,l;if(cached||(components[componentName]=xhrResponseText),xhrResponseText=xhrResponseText.replace(/^[^{]*/,"").replace(/;?$/,""),obj=eval("("+xhrResponseText+")"),params&&(usedParams=FG.object.digForValue(obj,/#PARAM{([^}|]*)?\|?([^}]*)}/),l=usedParams.length))for(i=0;l>i;i++)foundParam=FG.checkNS(usedParams[i].regexp[1],params),foundParamValue=foundParam?foundParam:usedParams[i].regexp[2]||"",(typeof foundParamValue).match(/string/i)?(foundParamValueReplaced=FG.checkNS(usedParams[i].path,obj).replace(usedParams[i].regexp[0],foundParamValue),_overwrite(obj,usedParams[i].path,foundParamValueReplaced)):_overwrite(obj,usedParams[i].path,foundParamValue);component.container?_mergeComponent(self.config,component.container,obj):self.config=obj,innerPromise.done()},cached?cback(components[componentName]):(xhrStart=+new Date,FG.io.get(componentName,cback,!0))):(end=+new Date,self.endPromise.done(self.config),countPromise.done(elementsN),solveTime.done(end-start))}(),langFunc&&langFunc(self.config),countPromise.then(function(e,n){console.log("Engy components used: "+n[0])}),solveTime.then(function(e,n){console.log("Engy time for getting components via xhr: "+xhrTot),console.log('      "       unfolding : '+(n[0]-xhrTot)),console.log('      "       solving (xhr included): '+n[0])}),self.endPromise},{process:process,get:function(e,n,t){var o=FG.Promise.create();return process(e).then(function(e,n){o.done(FG.Widgzard.get(n[0]))}),o},load:function(e){return FG.Widgzard.load(e)},getElement:function(e){return FG.Widgzard.getElement(e)},getElements:function(){return FG.Widgzard.getElements()},render:function(e,n,t){var o=+new Date,r=FG.Promise.create();return process(e).then(function(e,i){console.log("t: "+(+new Date-o)),r.done(FG.Widgzard.render(i[0],n,t))}),r}}},FG);