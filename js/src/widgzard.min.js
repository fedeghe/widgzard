!function(){"use strict";function t(t,e,n){var o=this,r=t.tag||"div";this.target=e,this.node=document.createElement(r),this.conf=t,this.WIDGZARD_cb=t.cb||function(){f&&console.log("autoresolving  ",o.node),o.resolve()},this.root=n.root,this.parent=e,this.WIDGZARD_promise=c.create(),this.WIDGZARD_promise.then(o.WIDGZARD_cb,o),this.map=n.map,this.abort=n.abort,this.getNode=n.getNode,this.getNodes=n.getNodes,this.WIDGZARD_len=t.content?t.content.length:0,this.done=this.resolve=this.solve=function(){0==--o.target.WIDGZARD_len&&(o.target.WIDGZARD_promise?o.target.WIDGZARD_promise.done():o.target.WIDGZARD_cb())},this.lateWid=n.lateWid}function e(t){var e=t.node,n=function(t){return t.parentNode.removeChild(t),!0},o=[],r=["WIDGZARD","WIDGZARD_cb","WIDGZARD_promise","WIDGZARD_length","parent","getNode","climb","root","done","resolve","data"],i=r.length,c=0,s=0,a=0,u=null;for(l(e,function(t){t!==e&&3!=t.nodeType&&o.push(t)&&a++},"post");a>s;){for(u=o[s++];i>c;)u[r[c++]]=null;n(u)}return o=null,r=null,!0}function n(n,o){var r={node:n.target||document.body,endFunctions:[]},i={node:document.createDocumentFragment("div")},c=!0,s=r.node.innerHTML+"";if(f=!!n.debug,h&&r.WIDGZARD&&e(r),!n)throw new Exception("ERROR : Check parameters for render function");var a={root:r,map:{},getNode:function(t){return a.map[t]||!1},getNodes:function(){return a.map},abort:function(){return c=!1,r.node.innerHTML=s,"onAbort"in n&&(typeof n.onAbort).match(/function/i)&&n.onAbort.call(null,n),!1},lateWid:function(t){a.map[t]=this}};return p.setAttrs(r.node,n.attrs).setStyle(r.node,n.style).setData(r,n.data).setData(i,n.data),r.descendant=p.descendant,i.descendant=p.descendant,o&&(r.node.innerHTML=""),"undefined"!=typeof n.html&&(r.node.innerHTML=n.html),r.WIDGZARD_len=n.content?n.content.length:0,i.WIDGZARD_len=n.content?n.content.length:0,i.WIDGZARD_cb=r.WIDGZARD_cb=function(){if(c&&r.node.appendChild(i.node)&&n.cb&&n.cb.call(r),r.endFunctions.length)for(var t=0,e=r.endFunctions.length;e>t;t++)r.endFunctions[t]()},r.WIDGZARD=!0,r.getNode=i.getNode=a.getNode,r.getNodes=i.getNodes=a.getNodes,r.abort=i.abort=a.abort,p.checkInit(i,n),function l(e,n){if(!c)return!1;if(e.content)for(var o=0,r=e.content.length;r>o;o++)e.content[o]===u&&(e.content[o]={tag:"br",attrs:{"class":u}}),l(e.content[o],new t(e.content[o],n,a).add())}(n,i),"content"in n||i.WIDGZARD_cb(),r}function o(t){var e=document.createElement("div");return t.target=e,n(t),e}function r(t,e){n({target:t,content:[{html:e||""}]},!0)}function i(t){var e=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(e),e.src=t,e.onload=function(){e.parentNode.removeChild(e)}}var c,s,a,l,u="clearer",d="wid",h=!0,f=!1,p=t.prototype;p.climb=function(t){t=t||1;for(var e=this;t--;)e=e.parent;return e},p.descendant=function(){var t=this,e=Array.prototype.slice.call(arguments,0),n=0,o=t,r=e.length;if(!r)return o;for(;r>n;)o=o.childrens[~~e[n++]];return o},p.setAttrs=function(t,e){if("undefined"!=typeof e)for(var n in e)"class"!==n?"style"!==n?t.setAttribute(n,e[n]):this.setStyle(t,e.style):t.className=e[n];return this},p.setStyle=function(t,e){if("undefined"!=typeof e)for(var n in e)t.style[n.replace(/^float$/i,"cssFloat")]=e[n];return this},p.setData=function(t,e){return t.data=e||{},this},p.checkInit=function(t,e){var n=!0;return"init"in e&&"function"==typeof e.init&&(n=e.init.call(t),!n&&t.abort()),this},p.checkEnd=function(t,e){return"end"in e&&"function"==typeof e.end&&this.root.endFunctions.push(function(){e.end.call(t)}),this},p.add=function(){var t,e=this.conf,n=this.node;return this.setAttrs(n,e.attrs).setStyle(n,e.style).setData(this,e.data).checkInit(this,e).checkEnd(this,e),"undefined"!=typeof e.html&&(n.innerHTML=e.html),"undefined"!=typeof e.text&&(t=document.createTextNode(""+e.text),n.appendChild(t)),"undefined"!=typeof e[d]&&(this.map[e[d]]=this),(e.target||this.target.node).appendChild(n),"childrens"in(e.target||this.target)||((e.target||this.target).childrens=[]),(e.target||this.target).childrens.push(this),this.WIDGZARD=!0,(!e.content||0==e.content.length)&&this.WIDGZARD_cb.call(this),this},c=function(){function t(t,e){for(var o=new n,r=function(){return t[0].apply(o,[o].concat([e])),o}(),i=[r],c=1,s=t.length;s>c;c++)i.push(i[c-1].then(t[c]));return o}function e(t,e){var o=new n,r=[],i=[],c=0,s=t.length,a=s,l=function(t){!t&&o.done.apply(o,r)};for(null;s>c;c++)!function(o){i[o]=new n;var c=t[o].apply(i[o],[i[o],e]);(c instanceof n?c:i[o]).then(function(t,e){r[o]=e,l(--a)})}(c);return o}var n=function(){this.cbacks=[],this.solved=!1,this.result=null},o=n.prototype;return o.then=function(t,e){var n=this,o=function(){n.solved=!1,t.apply(e||n,[e||n,n.result])};return this.solved?o():this.cbacks.push(o),this},o.done=function(){var t=[].slice.call(arguments,0);return this.result=t,this.solved=!0,this.cbacks.length?void this.cbacks.shift()(t):this.result},{create:function(){return new n},chain:t,join:e}}(),l=function(t,e,n){n={pre:"pre",post:"post"}[n]||"post";var o=function(){},r="pre"===n?e:o,i="post"===n?e:o,c=function(){return function(t,e){for(r(t),e=t.firstChild;e;)c(e),e=e.nextSibling;i(t)}}();c(t)},a=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e||window,[].concat(n,Array.prototype.slice.call(arguments)))}},s=function(t){return"<pre>"+t.replace(/&(?![\w\#]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")+"</pre>"},$ns$.Widgzard={render:n,cleanup:r,get:o,load:i,htmlspecialchars:s,Promise:c}}(this);