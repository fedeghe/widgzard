!function(){"use strict";function t(t,e,n){var o=this,r=t.tag||"div";this.target=e,this.node=document.createElement(r),this.conf=t,this.WIDGZARD_cb=t.cb||function(){h&&console.log("autoresolving  ",o.node),o.resolve()},this.root=n.root,this.parent=e,this.WIDGZARD_promise=p.create(),this.WIDGZARD_promise.then(o.WIDGZARD_cb,o),this.map=n.map,this.abort=n.abort,this.getNode=n.getNode,this.getNodes=n.getNodes,this.WIDGZARD_len=t.content?t.content.length:0,this.done=this.resolve=this.solve=function(){0==--o.target.WIDGZARD_len&&(o.target.WIDGZARD_promise?o.target.WIDGZARD_promise.done():o.target.WIDGZARD_cb())},this.lateWid=n.lateWid}function e(t){var e=t.node,n=function(t){return t.parentNode.removeChild(t),!0},o=[],r=["WIDGZARD","WIDGZARD_cb","WIDGZARD_promise","WIDGZARD_length","parent","getNode","climb","root","done","resolve","data"],i=r.length,c=0,a=0,d=0,l=null;for(s(e,function(t){t!==e&&3!=t.nodeType&&o.push(t)&&d++},"post");d>a;){for(l=o[a++];i>c;)l[r[c++]]=null;n(l)}return o=null,r=null,!0}function n(n,o){var r={node:n.target||document.body,endFunctions:[]},i={node:document.createDocumentFragment("div")},c=!0,a=r.node.innerHTML+"";if(h=!!n.debug,u&&r.WIDGZARD&&e(r),!n)throw new Exception("ERROR : Check parameters for render function");var s={root:r,map:{},getNode:function(t){return s.map[t]||!1},getNodes:function(){return s.map},abort:function(){return c=!1,r.node.innerHTML=a,"onAbort"in n&&(typeof n.onAbort).match(/function/i)&&n.onAbort.call(null,n),!1},lateWid:function(t){s.map[t]=this}};return f.setAttrs(r.node,n.attrs).setStyle(r.node,n.style).setData(r,n.data).setData(i,n.data),r.descendant=f.descendant,i.descendant=f.descendant,o&&(r.node.innerHTML=""),"undefined"!=typeof n.html&&(r.node.innerHTML=n.html),r.WIDGZARD_len=n.content?n.content.length:0,i.WIDGZARD_len=n.content?n.content.length:0,i.WIDGZARD_cb=r.WIDGZARD_cb=function(){if(c&&r.node.appendChild(i.node)&&n.cb&&n.cb.call(r),r.endFunctions.length)for(var t=0,e=r.endFunctions.length;e>t;t++)r.endFunctions[t]()},r.WIDGZARD=!0,r.getNode=i.getNode=s.getNode,r.getNodes=i.getNodes=s.getNodes,r.abort=i.abort=s.abort,f.checkInit(i,n),function l(e,n){if(!c)return!1;if(e.content)for(var o=0,r=e.content.length;r>o;o++)e.content[o]===d&&(e.content[o]={tag:"br",attrs:{"class":d}}),l(e.content[o],new t(e.content[o],n,s).add())}(n,i),"content"in n||i.WIDGZARD_cb(),r}function o(t){var e=document.createElement("div");return t.target=e,n(t),e}function r(t,e){n({target:t,content:[{html:e||""}]},!0)}function i(t){var e=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(e),e.src=t,e.onload=function(){e.parentNode.removeChild(e)}}var c,a,s,d="clearer",l="wid",u=!0,h=!1,f=t.prototype,p=$ns$.Promise;f.climb=function(t){t=t||1;for(var e=this;t--;)e=e.parent;return e},f.descendant=function(){var t=this,e=Array.prototype.slice.call(arguments,0),n=0,o=t,r=e.length;if(!r)return o;for(;r>n;)o=o.childrens[~~e[n++]];return o},f.setAttrs=function(t,e){if("undefined"!=typeof e)for(var n in e)"class"!==n?"style"!==n?t.setAttribute(n,e[n]):this.setStyle(t,e.style):t.className=e[n];return this},f.setStyle=function(t,e){if("undefined"!=typeof e)for(var n in e)t.style[n.replace(/^float$/i,"cssFloat")]=e[n];return this},f.setData=function(t,e){return t.data=e||{},this},f.checkInit=function(t,e){var n=!0;return"init"in e&&"function"==typeof e.init&&(n=e.init.call(t),!n&&t.abort()),this},f.checkEnd=function(t,e){return"end"in e&&"function"==typeof e.end&&this.root.endFunctions.push(function(){e.end.call(t)}),this},f.add=function(){var t,e=this.conf,n=this.node;return this.setAttrs(n,e.attrs).setStyle(n,e.style).setData(this,e.data).checkInit(this,e).checkEnd(this,e),"undefined"!=typeof e.html&&(n.innerHTML=e.html),"undefined"!=typeof e.text&&(t=document.createTextNode(""+e.text),n.appendChild(t)),"undefined"!=typeof e[l]&&(this.map[e[l]]=this),(e.target||this.target.node).appendChild(n),"childrens"in(e.target||this.target)||((e.target||this.target).childrens=[]),(e.target||this.target).childrens.push(this),this.WIDGZARD=!0,(!e.content||0==e.content.length)&&this.WIDGZARD_cb.call(this),this},s=function(t,e,n){n={pre:"pre",post:"post"}[n]||"post";var o=function(){},r="pre"===n?e:o,i="post"===n?e:o,c=function(){return function(t,e){for(r(t),e=t.firstChild;e;)c(e),e=e.nextSibling;i(t)}}();c(t)},a=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e||window,[].concat(n,Array.prototype.slice.call(arguments)))}},c=function(t){return"<pre>"+t.replace(/&(?![\w\#]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")+"</pre>"},$ns$.Widgzard={render:n,cleanup:r,get:o,load:i,htmlspecialchars:c,Promise:p}}(this);