!function(t){"use strict";function e(t,n,r){var o,i=t.split(/\.|\//),a=i.length,c="undefined";return typeof r===c&&(r=window),typeof n===c&&(n={}),"function"==typeof n&&(n=n()),r[i[0]]||(r[i[0]]=1===a?n:{}),o=r[i[0]],a>1?e(i.slice(1).join("."),n,r[i[0]]):o}function n(t,e){var n=t.split(/\.|\//),r=0,o=n.length;if(e=void 0!==e?e:W,!t)return e;for(null;o>r;r+=1){if("undefined"==typeof e[n[r]])return void 0;e=e[n[r]]}return e}var r=!1;e(t,{makeNS:e,checkNS:n,debug:function(t){r=!!t},dbg:function(t){if(!r)return void 0;try{console.log(t)}catch(e){try{opera.postError(t)}catch(n){alert(t)}}}}),e(t+".utils",{uniqueId:new function(){var e=0,n=this;this.prefix=t+"_",this.toString=function(){return n.prefix+ ++e}}})}("FG"),FG.util={uniqueid:new function(){var t=0,e=this;this.prefix="FG",this.toString=function(){return++t,e.prefix+t}},isValidEmail:function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},delegate:function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e||null,[].concat(n,Array.prototype.slice.call(arguments,0)))}}},FG.object=function(){function t(t,e){var n,r="";for(n in t)t.hasOwnProperty(n)&&(r+=e(t,n,r));return r}function e(t,e){return"undefined"!=typeof JSON?JSON.stringify(t)===JSON.stringify(e):t==e}function n(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function r(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}function o(t,o,i){if(!t.match(/key|value/))throw new Error("Bad param for object.digFor");var a={key:function(t,n,r){return FG.object.isString(t)&&r instanceof RegExp?t.match(r):e(t,r)},value:function(t,n,r){return FG.object.isString(n)&&r instanceof RegExp?n.match(r):e(n,r)}}[t],c=[],s=function(t,e,n,r,o){var i=[].concat.call(t,[e]),s=a(e,r[e],n);s&&c.push({value:r[e],key:i[i.length-1],parentKey:i[i.length-2],path:i.join("/"),container:i.slice(0,i.length-1).join("/"),parentContainer:i.slice(0,i.length-2).join("/"),regexp:s,level:o}),u(r[e],n,i,o+1)},u=function(t,e,o,i){if(!n(t)&&!r(t)){var a,c;if(t instanceof Array)for(a=0,c=t.length;c>a;a++)s(o,a,e,t,i);else{if("object"!=typeof t)return;for(a in t)s(o,a,e,t,i)}}};return u(o,i,[],0),c}return{toQs:function(e){return t(e,function(t,e,n){return((n?"&":"?")+encodeURIComponent(e)+"="+encodeURIComponent(t[e])).replace(/\'/g,"%27")})},jCompare:e,digForKey:function(t,e){return o("key",t,e)},digForValue:function(t,e){return o("value",t,e)},isString:function(t){return"string"==typeof t||t instanceof String},extend:function(t,e,n){var r,o=FG.object.clone(t);for(r in e)!e.hasOwnProperty(r)||r in o&&!n||(o[r]=e[r]);return o},clone:function(t){var e,n,r,o=FG.object;if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return e=new Date,e.setTime(t.getTime()),e;if(t instanceof Array){for(e=[],n=0,r=t.length;r>n;n++)e[n]=o.clone(t[n]);return e}if(t instanceof Object){e={};for(n in t)t.hasOwnProperty(n)&&(e[n]=o.clone(t[n]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")}}}(),FG.makeNS("FG/io"),FG.io=function(){var W=window,_={getxhr:function(){var t,e=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"],n=e.length,r=0;try{t=new W.XMLHttpRequest}catch(o){for(null;n>r;r+=1)try{t=new W.ActiveXObject(e[r])}catch(i){continue}!t&&alert("No way to initialize XHR")}return t},ajcall:function(t,e){var n=_.getxhr(),r=e&&e.method||"POST",o=e&&e.cback,i=e&&e.opened||function(){},a=e&&e.loading||function(){},c=e&&e.error||function(){},s=e&&e.abort||function(){},u=e&&e.async||!0,l=e&&e.data||!1,f=e&&e.type||"text/html",d=e&&void 0!==e.cache?e.cache:!0,p="xml"===f?"responseXML":"responseText",h=e&&e.timeout||3e3,m=!1,g=!1,y=!1,v=!1;d||(l.C=+new Date),l=FG.object.toQs(l).substr(1),n.onreadystatechange=function(){var t;if(v===n.readyState)return!1;if(v=n.readyState,"complete"===n.readyState||4===n.readyState&&200===n.status)return m=!0,o&&(g=n[p],function(){o(g)}(g)),y=n[p],W.setTimeout(function(){n=null},50),y;if(3===n.readyState)a(n);else if(2===n.readyState)i(n);else if(1===n.readyState)switch(r){case"POST":try{n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(l||!0)}catch(e){}break;case"GET":try{t={xml:"text/xml",html:"text/html",json:"application/json"}[f]||"text/html",n.setRequestHeader("Accept",t+"; charset=utf-8"),n.send(null)}catch(c){}break;default:alert(r),n.send(null)}return!0},n.onerror=function(){c&&c.apply(null,arguments)},n.onabort=function(){s&&s.apply(null,arguments)},n.open(r,"GET"===r?t+(l?"?"+l:""):t,u),W.setTimeout(function(){m||(m=!0,n.abort())},h);try{return"responseXML"===p?n[p].childNodes[0]:n[p]}catch(b){}return!0}};return{getxhr:_.getxhr,post:function(t,e,n,r,o,i){return _.ajcall(t,{cback:e,method:"POST",async:!!n,data:r,cache:o,error:i})},get:function(t,e,n,r,o,i){return _.ajcall(t,{cback:e||function(){},method:"GET",async:!!n,data:r,cache:o,error:i})},getJson:function(uri,cback,data){return _.ajcall(uri,{type:"json",method:"GET",cback:function(r){cback(W.JSON&&W.JSON.parse?JSON.parse(r):eval("("+r+")"))},data:data})},getXML:function(t,e){return _.ajcall(t,{method:"GET",type:"xml",cback:e||function(){}})}}}(),FG.makeNS("FG/css"),FG.css.style=function(t,e,n){var r,o="object"==typeof e&&"undefined"==typeof n,i=!1;if(!o&&"undefined"==typeof n)return i=t.currentStyle?t.currentStyle[e]:t.style[e];if(o)for(r in e)t.style[r]=e[r];else"undefined"!=typeof n&&(n+="",t.style[e]=n,"opacity"===e&&(t.style.filter="alpha(opacity = "+~~(100*parseFloat(n,10))+")"))},FG.dom={addClass:function(t,e){var n=t.className?t.className:"",r=new RegExp("(\\s|^)"+e+"(\\s|$)");n.match(r)||(t.className=e+" "+n)},removeClass:function(t,e){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")},descendant:function(){var t=Array.prototype.slice.call(arguments,0),e=0,n=t.shift(),r=t.length;if(!r)return n;for(;r>e;)n=n.children.item(~~t[e++]);return n},remove:function(t){var e=t.parentNode;e.removeChild(t)}},FG.makeNS("FG/events"),FG.events.on=function(t){var e;return e="addEventListener"in t?function(t,e,n){t.addEventListener.apply(t,[e,n,!1])}:"attachEvent"in t?function(t,e,n){t.attachEvent.apply(t,["on"+e,n])}:function(){throw new Error("No straight way to bind an event")}}(this),FG.events.eventTarget=function(t){t=t?t:window.event;var e=t.currentTarget||"undefined"!=typeof t.target?t.target:t.srcElement;if(!e)return!1;for(;3===e.nodeType&&null!==e.parentNode;)e=e.parentNode;return e},FG.events.kill=function(t){return t||(t=W.event,t.cancelBubble=!0,t.returnValue=!1),"stopPropagation"in t&&t.stopPropagation()&&t.preventDefault(),!1},FG.events.ready=function(){var t=[],e=setInterval(function(){if("complete"===document.readyState){clearInterval(e);for(var n=0,r=t.length;r>n;n++)t[n].call(this)}},10);return function(e){"complete"===document.readyState?e.call(this):t.push(e)}}(),FG.events.transitionEnd=function(){var t,e=document.createElement("fake"),n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in n)if(void 0!==e.style[t])return n[t]}(),FG.Channel=function(){var t={},e=function(t,e){if("indexOf"in t)return t.indexOf(e);for(var n=t.length-1;t[n]!==e;)n--;return n},n=function(){this.topic2cbs={},this.enabled=!0};return n.prototype={enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},pub:function(t,e){var n,r=0;if(!(t in this.topic2cbs&&this.enabled))return!1;for(n=this.topic2cbs[t].length;n>r;r+=1)this.topic2cbs[t][r].apply(null,[t].concat(e));return!0},sub:function(t,n,r){var o,i=0;if(t instanceof Array)for(o=t.length;o>i;i+=1)this.sub(t[i],n);return t in this.topic2cbs&&this.enabled||(this.topic2cbs[t]=[]),!r&&e(this.topic2cbs[t],n)>=0?this:void this.topic2cbs[t].push(n)},unsub:function(t,n){var r,o=0;if(t instanceof Array)for(r=t.length;r>o;o+=1)this.unsub(t[o],n);return t in this.topic2cbs&&(o=e(this.topic2cbs[t],n),o>=0&&this.topic2cbs[t].splice(o,1)),this},once:function(t,e){var n=this,r=function(){e.apply(null,Array.prototype.slice.call(arguments,0)),n.unsub(t,r)};this.sub(t,r)},reset:function(){var t=Array.prototype.slice.call(arguments,0),e=t.length,n=0;if(!e)return this.topic2cbs={},this;for(null;e>n;n+=1)t[n]in this.topic2cbs&&(this.topic2cbs[t[n]]=[]);return this}},function(e){return e in t?t[e]:t[e]=new n}}(),FG.Promise=function(){function t(t,e){for(var r=new n,o=function(){return t[0].apply(r,[r].concat([e])),r}(),i=[o],a=1,c=t.length;c>a;a++)i.push(i[a-1].then(t[a]));return r}function e(t,e){var r=new n,o=[],i=[],a=0,c=t.length,s=c,u=function(t){!t&&r.done.apply(r,o)};for(null;c>a;a++)!function(r){i[r]=new n;var a=t[r].apply(i[r],[i[r],e]);(a instanceof n?a:i[r]).then(function(t,e){o[r]=e,u(--s)})}(a);return r}var n=function(){this.cbacks=[],this.solved=!1,this.result=null},r=n.prototype;return r.then=function(t,e){var n=this,r=function(){n.solved=!1,t.apply(e||n,[e||n,n.result])};return this.solved?r():this.cbacks.push(r),this},r.done=function(){var t=[].slice.call(arguments,0);return this.result=t,this.solved=!0,this.cbacks.length?void this.cbacks.shift()(t):this.result},{create:function(){return new n},chain:t,join:e}}(),function(){"use strict";function t(t,e,n){var r=this,o=t.tag||"div";this.target=e,this.node=document.createElement(o),this.conf=t,this.WIDGZARD_cb=t.cb||function(){d&&console.log("autoresolving  ",r.node),r.resolve()},this.root=n.root,this.parent=e,this.WIDGZARD_promise=h.create(),this.WIDGZARD_promise.then(r.WIDGZARD_cb,r),this.map=n.map,this.abort=n.abort,this.getNode=n.getNode,this.getNodes=n.getNodes,this.WIDGZARD_len=t.content?t.content.length:0,this.done=this.resolve=this.solve=function(){0==--r.target.WIDGZARD_len&&(r.target.WIDGZARD_promise?r.target.WIDGZARD_promise.done():r.target.WIDGZARD_cb())},this.lateWid=n.lateWid}function e(t){var e=t.node,n=function(t){return t.parentNode.removeChild(t),!0},r=[],o=["WIDGZARD","WIDGZARD_cb","WIDGZARD_promise","WIDGZARD_length","parent","getNode","climb","root","done","resolve","data"],i=o.length,a=0,c=0,u=0,l=null;for(s(e,function(t){t!==e&&3!=t.nodeType&&r.push(t)&&u++},"post");u>c;){for(l=r[c++];i>a;)l[o[a++]]=null;n(l)}return r=null,o=null,!0}function n(r,o,i){var a,c=+new Date,s={node:r.target||document.body,endFunctions:[],reload:function(){n(r,!0)}},l={node:document.createDocumentFragment("div")},h=!0,g=s.node.innerHTML+"";if(d=!!r.debug,f&&s.WIDGZARD&&e(s),!r)throw new Exception("ERROR : Check parameters for render function");var y={root:s,map:{},getNode:function(t){return y.map[t]||!1},getNodes:function(){return y.map},abort:function(){return h=!1,s.node.innerHTML=g,"onAbort"in r&&(typeof r.onAbort).match(/function/i)&&r.onAbort.call(null,r),!1},lateWid:function(t){y.map[t]=this}};return p.setAttrs(s.node,r.attrs).setStyle(s.node,r.style).setData(s,r.data).setData(l,r.data),s.descendant=p.descendant,l.descendant=p.descendant,o&&(s.node.innerHTML=""),"undefined"!=typeof r.html&&(s.node.innerHTML=r.html),s.WIDGZARD_len=r.content?r.content.length:0,l.WIDGZARD_len=r.content?r.content.length:0,l.WIDGZARD_cb=s.WIDGZARD_cb=function(){if(h&&s.node.appendChild(l.node)&&r.cb&&r.cb.call(s),s.endFunctions.length)for(var t=0,e=s.endFunctions.length;e>t;t++)s.endFunctions[t]()},s.WIDGZARD=!0,s.getNode=l.getNode=y.getNode,s.getNodes=l.getNodes=y.getNodes,s.abort=l.abort=y.abort,p.checkInit(l,r),function v(e,n){if(!h)return!1;if(e.content)for(var r=0,o=e.content.length;o>r;r++)e.content[r]===u&&(e.content[r]={tag:"br",attrs:{"class":u}}),v(e.content[r],new t(e.content[r],n,y).add())}(r,l),"content"in r||l.WIDGZARD_cb(),!i||i in m||(m[i]=s),a=+new Date,console.debug("Widgzard render time: "+(a-c)+"ms"),s}function r(t){var e=document.createElement("div");return t.target=e,n(t),e}function o(t,e){n({target:t,content:[{html:e||""}]},!0)}function i(t){var e=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(e),e.src=t,e.onload=function(){e.parentNode.removeChild(e)}}var a,c,s,u="clearer",l="wid",f=!0,d=!1,p=t.prototype,h=FG.Promise,m={};p.climb=function(t){t=t||1;for(var e=this;t--;)e=e.parent;return e},p.descendant=function(){var t=this,e=Array.prototype.slice.call(arguments,0),n=0,r=t,o=e.length;if(!o)return r;for(;o>n;)r=r.childrens[~~e[n++]];return r},p.setAttrs=function(t,e){if("undefined"!=typeof e)for(var n in e)"class"!==n?"style"!==n?t.setAttribute(n,e[n]):this.setStyle(t,e.style):t.className=e[n];return this},p.setStyle=function(t,e){if("undefined"!=typeof e)for(var n in e)t.style[n.replace(/^float$/i,"cssFloat")]=e[n];return this},p.setData=function(t,e){return t.data=e||{},this},p.checkInit=function(t,e){var n=!0;return"init"in e&&"function"==typeof e.init&&(n=e.init.call(t),!n&&t.abort()),this},p.checkEnd=function(t,e){return"end"in e&&"function"==typeof e.end&&this.root.endFunctions.push(function(){e.end.call(t)}),this},p.add=function(){var t,e=this.conf,n=this.node;return this.setAttrs(n,e.attrs).setStyle(n,e.style).setData(this,e.data).checkInit(this,e).checkEnd(this,e),"undefined"!=typeof e.html&&(n.innerHTML=e.html),"undefined"!=typeof e.text&&(t=document.createTextNode(""+e.text),n.appendChild(t)),"undefined"!=typeof e[l]&&(this.map[e[l]]=this),(e.target||this.target.node).appendChild(n),"childrens"in(e.target||this.target)||((e.target||this.target).childrens=[]),(e.target||this.target).childrens.push(this),this.WIDGZARD=!0,(!e.content||0==e.content.length)&&this.WIDGZARD_cb.call(this),this},s=function(t,e,n){n={pre:"pre",post:"post"}[n]||"post";var r=function(){},o="pre"===n?e:r,i="post"===n?e:r,a=function(){return function(t,e){for(o(t),e=t.firstChild;e;)a(e),e=e.nextSibling;i(t)}}();a(t)},c=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e||window,[].concat(n,Array.prototype.slice.call(arguments)))}},a=function(t){return"<pre>"+t.replace(/&(?![\w\#]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")+"</pre>"},FG.Widgzard={render:n,cleanup:o,get:r,load:i,htmlspecialchars:a,getElement:function(t){return t in m?m[t]:!1},getElements:function(){return m}}}(this),FG.makeNS("engy2",function(){function _overwrite(t,e,n){var r=e.split(/\.|\//),o=0,i=r.length;if(i>1)for(null;i-1>o;o++)t=t[r[o]];t[r[i-1]]=n}function _mergeComponent(t,e,n){{var r,o=FG.checkNS(e,t),i=n,a={},c=e.split(/\.|\//),r=0;c.length}for(r in i)a[r]=i[r];for(r in o)!r.match(/component|params/)&&(a[r]=o[r]);_overwrite(t,e,a)}function Processor(t){this.retFuncs=[],this.config=t,this.endPromise=FG.Promise.create()}var components={},CONST={fileNameSeparator:"/",ext:".js"},Engy={config:{componentsUrl:"/engy/components/"}};return Processor.prototype.run=function(){var self=this,foundComponents=FG.object.digForKey(self.config,"component"),i,l,myChain=[];if(foundComponents.length){for(i in foundComponents)(function(j){myChain.push(function(pro){function cback(xhrResponseText){var params=FG.checkNS(foundComponents[j].container+"/params",self.config),obj,usedParams,foundParam,foundParamValue,foundParamValueReplaced,i,l;if(cached||(components[componentName]=xhrResponseText),obj=eval("("+xhrResponseText.replace(/\/n|\/r/g,"").replace(/^[^{]*/,"").replace(/;?$/,"")+")"),params&&(usedParams=FG.object.digForValue(obj,/#PARAM{([^}|]*)?\|?([^}]*)}/),l=usedParams.length))for(i=0;l>i;i++)foundParam=FG.checkNS(usedParams[i].regexp[1],params),foundParamValue=foundParam?foundParam:usedParams[i].regexp[2]||"",(typeof foundParamValue).match(/string/i)?(foundParamValueReplaced=FG.checkNS(usedParams[i].path,obj).replace(usedParams[i].regexp[0],foundParamValue),_overwrite(obj,usedParams[i].path,foundParamValueReplaced)):_overwrite(obj,usedParams[i].path,foundParamValue);_mergeComponent(self.config,foundComponents[j].container,obj),pro.done()}var componentName=Engy.config.componentsUrl+foundComponents[j].value+CONST.ext,cached=componentName in components;cached?cback(components[componentName]):FG.io.get(componentName,cback,!0)})})(i);FG.Promise.chain(myChain).then(function(){self.run()})}else self.endPromise.done(self.config);return self.endPromise},Engy.process=function(t){return new Processor(t).run()},Engy.render=function(t,e,n){var r=+new Date,o=FG.Promise.create();return FG.engy2.process(t).then(function(t,i){var i=FG.Widgzard.render(i[0],e,n);console.log("t: "+(+new Date-r)),o.done(i)}),o},Engy},FG);